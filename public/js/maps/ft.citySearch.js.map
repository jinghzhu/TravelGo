{"version":3,"sources":["ft.citySearch.js"],"names":["getPointList","tmp","localStorage","pointList","tmpArr","unique","JSON","parse","console","log","xhttp","XMLHttpRequest","onreadystatechange","readyState","status","rs","eval","responseText","wp","activities","length","i","latLng","push","addRouteOnMap","loc","split","addorRemoveMark","lat","lng","centerMap","open","send","stringify","ids","endPoint","startPoint","arr","showRoute","addPoint","posId","objStr","obj","index","indexOf","splice","a","Array","from","Set","removePoint","id","list","bindAddToMapEvent","$","each","this","click","event","val","is","renderCity","data","cityList","imageUrl","title","duration","fromPrice","searchView","city","startDate","endDate","uri","get","cityListHtml","html","cityActions","addTestMark","pos","animatedSvg","img","price","icon","H","map","DomIcon","coords","marker","DomMarker","addEventListener","movin","moveout","tap","addObject","removeTestMark","removeObject","queryVal","window","location","search","substring","values","_location","_start","_end","text","protocol","host"],"mappings":"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","file":"ft.citySearch.js","sourcesContent":["console.log(1);\n//# sourceMappingURL=maps/ft.citySearch.js.map\n\n//获取line\nfunction getPointList(){\n  var tmp = localStorage.pointList;\n  var tmpArr = unique(JSON.parse(tmp));\n  console.log(tmpArr);\n// wp.push('50.11,8.68');\n  console.log(\"start\");\n  var xhttp = new XMLHttpRequest();\n  xhttp.onreadystatechange = function() {\n    if (xhttp.readyState == 4 && xhttp.status == 200) {\n      // console.info( xhttp.responseText);\n      var rs = eval('(' + xhttp.responseText + ')');\n\t  var wp = [];\n      console.log(rs);\n\t  if(rs.activities && rs.activities.length){\n\t\t  for (var i =0;i<rs.activities.length; i++) {\n\t\t\tif(rs.activities[i] != null){\n\t\t\t\tconsole.log(rs.activities[i].latLng);\n\t\t\t\twp.push(rs.activities[i].latLng);\n\t\t\t}\n\t\t  }\n\n\t\t  if(wp.length > 1){\n\t\t\t  addRouteOnMap(wp);\n\t\t  } else if(wp.length ===1){\n\t\t\t  var loc = wp[0].split(\",\");\n\t\t\t  addorRemoveMark({lat:loc[0],lng:loc[1]}, true);\n\t\t\t  centerMap({lat:loc[0],lng:loc[1]}, 5.73);\n\t\t  }\n\t\t}\n    }\n  };\n  xhttp.open(\"POST\", \"api/v1/routing\", true);\n  xhttp.send(JSON.stringify({\"ids\":tmpArr, \"endPoint\":tmpArr[tmpArr.length-1], \"startPoint\":tmpArr[0]}));\n\n  console.log(\"send\");\n  return tmpArr;\n}\n\n\nfunction addRouteOnMap(arr){\n  var wp=[];\n  for(var i=0;i<arr.length;i++){\n    wp.push(arr[i]);\n  }\n  showRoute(wp);\n}\n\n//添加点\nfunction addPoint(posId){\n  var objStr = localStorage.pointList;\n  var obj = [];\n\n  if(typeof(objStr) !== \"undefined\"){\n    obj = JSON.parse(objStr);\n  }\n\n  var ids = obj;\n  var index =  ids.indexOf(posId);\n  if(index!=\"-1\"){\n    //删除\n    ids.splice(index,1);\n  }else{\n    //添加\n    ids.push(posId);\n  }\n  unique(ids);\n  console.log(ids);\n  var tmp = JSON.stringify(ids);\n  localStorage.pointList = tmp;\n}\n\n//去重\nfunction unique(a) {\n  return Array.from(new Set(a));\n}\n\nfunction removePoint(id) {\n    var list = JSON.parse(localStorage.pointList);\n\n      for(var i = 0;i < list.length;i ++) {\n        if(id == list[i]) {\n            list.splice(i, 1);\n          }\n      }\n    localStorage.pointList = JSON.stringify(list);\n  }\n\n\n//添加交互事件\nfunction bindAddToMapEvent() {\n  $('.select').each(function () {\n    $(this).click(function (event) {\n      var id = $(this).val();\n      if($(this).is(':checked')) {\n        addPoint(id);\n\t\tgetPointList();\n      } else {\n        removePoint(id);\n\t\tgetPointList();\n      }\n    });\n  });\n}\n\n// Render City\nfunction renderCity(data) {\n  var cityList = '';\n  cityList += \"<section class='col-xs-10 col-md-6'><figure class='figure-attraction-card'>\";\n  cityList += \"<div class='actions'><span class='startLoc'>start</span><input class='select' type='checkbox' value=\" + data.id + \"></div>\";\n  cityList += \"<img class='img-responsive' src='\" + data.imageUrl + \"' alt='travel go' />\";\n  cityList += \"<figcaption>\";\n  cityList += \"<p class='attraction-name' title='\" + data.title + \"'>\" + data.title + \"</p>\";\n  cityList += \"<p class='attraction-duration btn btn-primary'><span class='duration-title'>Duration:</span>\";\n  cityList += \"<span class='duration-content'>\" + data.duration + \"</span></p>\";\n  // cityList += \"<p class='attraction-description'>\"+ data.supplierName + \"</p>\";\n  // cityList += \"<p class='attraction-description'>\"+ data.redemptionType +\"</p>\";\n  // cityList += \"<p class='attraction-description'>\"+ data.fromPrice + \"</p>\";\n  cityList += \"<p class='attraction-description'>\"+ data.fromPrice + \"</p>\";\n  cityList += \"</figcaption>\";\n  cityList += \"</figure></section>\";\n\n  return cityList;\n}\n\nvar queryVal = window.location.search,\n  queryVal = queryVal.substring(1),\n  values = queryVal.split('&'),\n  loc = values[0].split('=')[1],\n  startDate = values[1].split('=')[1],\n  endDate = values[2].split('=')[1],\n  _location = $('#location').val() || loc,\n  _start = $('#startDate').val() || startDate,\n  _end = $('#endDate').val() || endDate;\n\n$('#location').val(loc);\n$('#startDate').val(startDate);\n$('#endDate').val(endDate);\n$('#topLoc').text(loc);\n$('#firstDate').text(startDate);\n\nsearchView(_location, _start, _end);\n\n$('#search').click(function () {\n  var _location = $('#location').val(),\n  _start = $('#startDate').val(),\n  _end = $('#endDate').val();\n\n  $('#topLoc').text(_location);\n  $('#firstDate').text(_start);\n\n  location = location.protocol + '//' + location.host +'/main?location=' + _location + '&start=' + _start + '&end=' + _end;\n\n  // searchView(_location, _start, _end);\n});\n\n//搜索函数\nfunction searchView(city, startDate, endDate) {\n  var uri = \"api/v1/list/\" + city + \"/\" + startDate + \"/\" + endDate;\n  $.get(uri,\n    {},\n    function (data) {\n      var rs = data;\n      var html = \"\";\n      var cityListHtml = \"\";\n      var arr = rs.activities[0].latLng.split(','),\n        obj = {};\n      obj.lat = arr[0];\n      obj.lng = arr[1];\n      centerMap(obj, 8);\n      for (var i in rs.activities) {\n        cityListHtml += renderCity(data.activities[i]);\n      }\n      $('#cityList').html(cityListHtml);\n      cityActions();\n      bindAddToMapEvent();\n\n    });\n}\n\nfunction addTestMark(data) {\n\n  var pos = {lat: data.lat, lng: data.lng};\n  var animatedSvg = \"<div class='mark-item'><ul><img src=\" + data.img + \"><li>\" + data.title + \"</li><li>价格：\" + data.price + \"</li></ul></div>\";\n\n  var icon = new H.map.DomIcon(animatedSvg),\n    coords = pos,\n    marker = new H.map.DomMarker(coords, {icon: icon});\n\n  //var marker = new H.map.Marker(pos);\n  marker.addEventListener('pointerenter', movin);\n  marker.addEventListener('pointerleave', moveout);\n  marker.addEventListener('tap', tap);\n  map.addObject(marker);\n}\n\nfunction removeTestMark(data) {\n  var pos = {lat: data.lat, lng: data.lng};\n  var coords = pos,\n    marker = new H.map.DomMarker(coords);\n  map.removeObject(marker);\n}\n"],"sourceRoot":"/source/"}