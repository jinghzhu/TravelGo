function getPointList(){var tmp=localStorage.pointList,tmpArr=unique(JSON.parse(tmp));console.log(tmpArr),console.log("start");var xhttp=new XMLHttpRequest;return xhttp.onreadystatechange=function(){if(4==xhttp.readyState&&200==xhttp.status){var rs=eval("("+xhttp.responseText+")"),wp=[];if(console.log(rs),rs.activities&&rs.activities.length){for(var i=0;i<rs.activities.length;i++)null!=rs.activities[i]&&(console.log(rs.activities[i].latLng),wp.push(rs.activities[i].latLng));if(wp.length>1)addRouteOnMap(wp);else if(1===wp.length){var loc=wp[0].split(",");addorRemoveMark({lat:loc[0],lng:loc[1]},!0),centerMap({lat:loc[0],lng:loc[1]},5.73)}}}},xhttp.open("POST","api/v1/routing",!0),xhttp.send(JSON.stringify({ids:tmpArr,endPoint:tmpArr[tmpArr.length-1],startPoint:tmpArr[0]})),console.log("send"),tmpArr}function addRouteOnMap(arr){for(var wp=[],i=0;i<arr.length;i++)wp.push(arr[i]);showRoute(wp)}function addPoint(posId){var objStr=localStorage.pointList,obj=[];"undefined"!=typeof objStr&&(obj=JSON.parse(objStr));var ids=obj,index=ids.indexOf(posId);"-1"!=index?ids.splice(index,1):ids.push(posId),unique(ids),console.log(ids);var tmp=JSON.stringify(ids);localStorage.pointList=tmp}function unique(a){return Array.from(new Set(a))}function removePoint(id){for(var list=JSON.parse(localStorage.pointList),i=0;i<list.length;i++)id==list[i]&&list.splice(i,1);localStorage.pointList=JSON.stringify(list)}function bindAddToMapEvent(){$(".select").each(function(){$(this).click(function(event){var id=$(this).val();$(this).is(":checked")?(addPoint(id),getPointList()):(removePoint(id),getPointList())})})}function renderCity(data){var cityList="";return cityList+="<section class='col-xs-10 col-md-6'><figure class='figure-attraction-card'>",cityList+="<div class='actions'><span class='startLoc'>start</span><input class='select' type='checkbox' value="+data.id+"></div>",cityList+="<img class='img-responsive' src='"+data.imageUrl+"' alt='travel go' />",cityList+="<figcaption>",cityList+="<p class='attraction-name' title='"+data.title+"'>"+data.title+"</p>",cityList+="<p class='attraction-duration btn btn-primary'><span class='duration-title'>Duration:</span>",cityList+="<span class='duration-content'>"+data.duration+"</span></p>",cityList+="<p class='attraction-description'>"+data.fromPrice+"</p>",cityList+="</figcaption>",cityList+="</figure></section>"}function searchView(city,startDate,endDate){var uri="api/v1/list/"+city+"/"+startDate+"/"+endDate;$.get(uri,{},function(data){var rs=data,cityListHtml="",arr=rs.activities[0].latLng.split(","),obj={};obj.lat=arr[0],obj.lng=arr[1],centerMap(obj,8);for(var i in rs.activities)cityListHtml+=renderCity(data.activities[i]);$("#cityList").html(cityListHtml),cityActions(),bindAddToMapEvent()})}function addTestMark(data){var pos={lat:data.lat,lng:data.lng},animatedSvg="<div class='mark-item'><ul><img src="+data.img+"><li>"+data.title+"</li><li>价格："+data.price+"</li></ul></div>",icon=new H.map.DomIcon(animatedSvg),coords=pos,marker=new H.map.DomMarker(coords,{icon:icon});marker.addEventListener("pointerenter",movin),marker.addEventListener("pointerleave",moveout),marker.addEventListener("tap",tap),map.addObject(marker)}function removeTestMark(data){var pos={lat:data.lat,lng:data.lng},coords=pos,marker=new H.map.DomMarker(coords);map.removeObject(marker)}console.log(1);var queryVal=window.location.search,queryVal=queryVal.substring(1),values=queryVal.split("&"),loc=values[0].split("=")[1],startDate=values[1].split("=")[1],endDate=values[2].split("=")[1],_location=$("#location").val()||loc,_start=$("#startDate").val()||startDate,_end=$("#endDate").val()||endDate;$("#location").val(loc),$("#startDate").val(startDate),$("#endDate").val(endDate),$("#topLoc").text(loc),$("#firstDate").text(startDate),searchView(_location,_start,_end),$("#search").click(function(){var _location=$("#location").val(),_start=$("#startDate").val(),_end=$("#endDate").val();$("#topLoc").text(_location),$("#firstDate").text(_start),location=location.protocol+"//"+location.host+"/main?location="+_location+"&start="+_start+"&end="+_end});
//# sourceMappingURL=maps/ft.citySearch.js.map
